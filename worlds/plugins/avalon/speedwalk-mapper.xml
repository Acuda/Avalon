<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Dienstag, September 09, 2014, 10:34  -->
<!-- MuClient version 4.92 -->

<!-- Plugin "avalon_speedwalk_mapper" generated by Plugin Wizard -->

<muclient>
<plugin
   name="avalon_speedwalk_mapper"
   author="Magician"
   id="deb5a26f21c54c6a913af6d9"
   language="Lua"
   purpose="Zeichnet Avalon Speedwalks auf und formatiert sie in das Soundpack-gerechte Format"
   save_state="y"
   date_written="2014-09-09 10:32:54"
   requires="4.70"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Aliases  -->

<aliases>
  <alias
   match="spm start"
   enabled="y"
   sequence="100"
   send_to="12"
  >
  <send>spm_start()</send>
  </alias>
  <alias
   match="spm z"
   enabled="y"
   sequence="100"
   send_to="12"
  >
  <send>spm_removelast()</send>
  </alias>
  <alias
   match="spm stop"
   enabled="y"
   sequence="100"
   send_to="12"
  >
  <send>spm_stop()</send>
  </alias>
</aliases>

<!--  Script  -->

<script>
<![CDATA[
Active=false
CmdStack={}
Warned=false
Shorters={}
Shorters.osten=o
Shorters.westen=w
Shorters.suedwesten=sw
Shorters.sueden=s
Shorters.norden=n
Shorters.suedosten=so
Shorters.nordosten=no
Shorters.nordwesten=nw
Directives={}
Directives.o='w'
Directives.so='nw'
Directives.s='n'
Directives.sw='no'
Directives.w='o'
Directives.nw='so'
Directives.n='s'
Directives.no='sw'
Directives.hoch='runter'
Directives.runter='hoch'
function OnPluginSend(text)
if Active then
text=_spm_processcommand(text)
CmdStack[#CmdStack+1]=text
end
return true
end
function spm_start()
Active=true
world.Note('Der Avalon Speedwalk Mapper zeichnet nun einen Speedwalk auf. Bitte verwende bis zum Ende der Aufnahme nur Kommandos, welche im eigentlichen Speedwalk auch auftauchen sollen. Es sollten außerdem keine selbst definierten Aliase verwendet werden')
end
function spm_stop()
Active=false
Warned=false
speedwalk=_spm_getspeedwalk()
world.SetClipboard(speedwalk)
CmdStack={}
world.Note('Die Aufnahme wurde beendet. Der Speedwalk befindet sich in der Zwischenablage.')
end
function spm_removelast()
world.Note('Kommando '..CmdStack[#CmdStack]..' wird gelöscht.')
CmdStack[#CmdStack]=nil
end
function _spm_getspeedwalk()
speedwalk=''
for index,cmd in pairs(CmdStack) do
speedwalk=speedwalk..cmd..' '
end
speedwalk=string.sub(speedwalk,1,-2)
return speedwalk
end
function _spm_processcommand(text)
text=string.lower(text)
if Shorters[text] then
text=Shorters[text]
end
if string.find(text,' ',1,true) then
text=world.Replace(text,' ','_',true)
end
if string.find(text,'e',1,true) then
text=world.Replace(text,'e','o',true)
end
if (not Directives[text]) and not (string.find(text,'kletter',1,true)==1) and not (string.find(text,'schwimm',1,true)==1) and (not Warned) then
world.Note('Dieses Kommando ist dem Speedwalk Mapper unbekannt. Falls dieses Kommando für die Aufnahme nicht vorgesehen war, können sie es jetzt mithilfe des Kommandos \'spm z\' entfernen.')
Warned=true
end
return text
end
]]>
</script>


</muclient>
